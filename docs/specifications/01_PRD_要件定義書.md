# PRD / 要件定義書 - シフト管理システム

**文書バージョン**: 2.0  
**作成日**: 2025年8月13日  
**更新日**: 2025年8月13日  
**プロジェクト名**: ShiftMaster - 位置情報連動シフト管理システム

---

## 1. エグゼクティブサマリー

### 1.1 プロジェクトの目的
位置情報による不正打刻防止とAIによる最適化機能を備えた、シンプルで使いやすいWebベースのシフト管理システムを開発し、中小規模の店舗運営業務の効率化と労務管理の適正化を実現する。

### 1.2 KPI・成功指標
| KPI項目 | 目標値 | 測定方法 | 測定頻度 |
|---------|--------|----------|----------|
| シフト作成時間の短縮 | 従来比80%削減 | 管理者操作ログ分析 | 月次 |
| 打刻不正の削減 | 95%削減 | 位置情報チェック成功率 | 週次 |
| システム稼働率 | 99.5%以上 | サーバー監視 | 日次 |
| ユーザー満足度 | 4.0/5.0以上 | アンケート調査 | 四半期 |
| 勤怠計算エラー | 月2件以下 | エラーログ分析 | 月次 |
| 従業員のシフト希望提出率 | 90%以上 | システム提出データ | 月次 |

### 1.3 対象ユーザー
**主要ペルソナ**
- **店舗管理者（30-50代）**: IT操作に慣れていない。シフト作成に月20時間を要している
- **従業員（20-40代）**: スマートフォン操作に慣れている。勤務希望の提出が面倒
- **店舗オーナー（40-60代）**: 人件費管理と勤怠の正確性を重視

**ユーザー規模**
- Phase 1: 1店舗10-50名規模
- Phase 2: 複数店舗対応（～500名）

---

## 2. MVPスコープ定義

### 2.1 MVP機能（Phase 1）
**必須機能**
- [x] 招待制ユーザー認証（メール/QR招待）
- [x] 位置情報連動の出退勤打刻
- [x] シフト希望提出（従業員）
- [x] AI支援シフト作成（管理者）
- [x] 勤怠管理・編集（管理者）
- [x] 基本的な設定管理

**含まれない機能（Phase 2以降）**
- [ ] 複数店舗管理
- [ ] 給与計算連携
- [ ] 詳細な分析・レポート機能
- [ ] モバイルアプリ
- [ ] 労基法違反自動チェック

### 2.2 技術制約・前提条件
**技術スタック**
- フロントエンド: Next.js 14 (App Router) + TypeScript
- スタイリング: Tailwind CSS + shadcn/ui
- バックエンド: Supabase (PostgreSQL + Auth + Edge Functions)
- AI連携: Google Gemini API
- デプロイ: Vercel

**制約事項**
- HTTPS必須（位置情報API要件）
- ブラウザ対応: Chrome/Safari/Edge最新版
- モバイル対応: レスポンシブデザイン
- 位置情報精度: GPS±50m以内

---

## 3. 詳細機能要件

### 3.1 認証・ユーザー管理

#### 3.1.1 招待制オンボーディング
**機能概要**: 管理者が発行する招待リンク/QRコードを通じた従業員登録

**要件**
- 管理者が従業員ごとに有効期限付き招待リンクを生成（24時間/72時間/7日）
- QRコード自動生成・表示機能
- メール送信（オプション）/リンク配布（必須）
- 従業員は招待リンク経由でパスワード設定・アカウント作成
- 招待リンクの失効・再発行機能

**受け入れ基準**
- [ ] 管理者が「従業員管理」画面で招待リンクを生成できる
- [ ] 生成された招待リンク/QRをコピー・印刷できる
- [ ] 従業員は招待リンクから5分以内にアカウント作成を完了できる
- [ ] 期限切れリンクは適切にエラー表示される
- [ ] 使用済みリンクは再利用できない

#### 3.1.2 ログイン・セッション管理
**機能概要**: Supabase Authによる安全なログイン

**要件**
- メールアドレス・パスワード認証
- パスワードリセット機能（メール送信）
- セッション自動延長（24時間）
- 強制ログアウト機能（管理者）

### 3.2 出退勤管理

#### 3.2.1 位置情報連動打刻
**機能概要**: 店舗半径50m以内での出退勤打刻システム

**詳細要件**
- GPS位置情報取得・店舗座標との距離計算（ハバースイン公式）
- 50m以内でのみ打刻ボタン有効化
- 打刻時の位置情報保存（緯度・経度）
- 重複打刻防止（同日内）
- オフラインでの打刻は非対応（要オンライン）

**UI/UX要件**
- 大型時計の常時表示（秒単位更新）
- 位置情報状況のリアルタイム表示
- 出勤/退勤完了画面（5秒自動遷移）
- loginモード（個人ログイン）/simpleモード（共用端末）の切替

**例外処理**
- 位置情報取得失敗時のフォールバック
- ネットワーク切断時のエラーハンドリング
- GPS精度低下時の警告表示

#### 3.2.2 休憩時間管理
**機能概要**: 退勤時の休憩時間入力

**要件**
- 退勤ボタン押下時に休憩時間入力モーダル表示
- クイック選択: なし/30分/45分/60分（デフォルト）
- カスタム入力: 15分単位で任意設定
- 実働時間の自動計算（勤務時間 - 休憩時間）

### 3.3 シフト管理

#### 3.3.1 シフト希望提出（従業員機能）
**機能概要**: 月次のシフト希望をカレンダーUIで入力

**詳細要件**
- 月単位での希望提出（前月25日締切）
- 日別の勤務可否選択（OK/NG、maybeは廃止）
- 希望時間の入力（15分刻み）
- 一括編集機能（複数日選択・範囲選択）
- 下書き保存・提出機能
- 提出後の編集制限（管理者による再開設定）

**UI仕様**
- PC: カレンダービュー + サイドパネル編集
- モバイル: カレンダー + ボトムシート編集
- 進捗バー表示（提出率%）
- クイック設定: 早番/日勤/遅番/終日可

#### 3.3.2 AI自動シフト作成（管理者機能）
**機能概要**: Google Gemini APIによる最適シフト生成

**詳細要件**
- 3ステップワークフロー: 希望確認 → AI生成 → 手動調整
- ルールセット管理（勤務パターン/必要人数/カスタムルール）
- 従業員の希望（OK/NG）・過去データ・労働時間制限を考慮
- 人員配置最適化（ポジション別・時間帯別）
- 手動編集機能（シフト表ビュー・人員数ビュー）

**AI最適化要素**
- 従業員希望の最大限考慮
- ポジション別必要人数の充足
- 労働時間の均等分散
- 連続勤務日数の制限
- 経験者の適切配置

#### 3.3.3 シフト確定・配信
**機能概要**: 作成したシフトの確定・従業員への通知

**要件**
- 下書き保存機能（管理者ごと1件まで）
- CSV出力機能
- 確定シフトの従業員画面自動反映
- 変更履歴の保存

### 3.4 管理者機能

#### 3.4.1 ダッシュボード
**機能概要**: 店舗の運営状況を一覧で把握

**表示項目**
- 今週の提出状況サマリー（提出件数・未提出者・勤怠修正申請）
- シフト希望提出進捗バー・従業員別状況
- クイックアクション（シフト作成・従業員管理・勤怠管理）
- 最近の更新情報（シフト保存・希望提出・勤怠修正）

#### 3.4.2 従業員管理
**機能概要**: 従業員情報の登録・編集・招待管理

**機能詳細**
- 従業員情報（基本情報・雇用情報・社会保険・有給）
- CSV取込/エクスポート
- 検索・フィルタ機能（雇用形態・ステータス・キーワード）
- 月間労働時間上限管理・実績表示
- 招待リンク生成・管理

#### 3.4.3 勤怠管理
**機能概要**: 勤怠データの閲覧・修正

**機能詳細**
- 日次ビュー（全従業員の1日の勤怠）
- 月次ビュー（1従業員の月間勤怠）
- 勤怠修正機能（理由記録必須）
- 位置情報チェック結果表示
- CSV出力機能

#### 3.4.4 店舗設定
**機能概要**: 店舗運営ルールの設定

**設定項目**
- 基本情報（店舗名・住所・打刻位置）
- 営業時間・定休日設定
- 打刻・計上ルール（丸め・猶予時間）
- 休憩ルール（自動付与設定）
- ポジション管理（色分け・並び順）
- 決済管理（Stripe Customer Portal）

### 3.5 システム管理（運営向け）

#### 3.5.1 マルチテナント管理
**機能概要**: 複数店舗の管理・監視

**要件**
- 店舗一覧・詳細表示
- 課金ステータス管理（free/sponsored/paid）
- 招待コード管理・発行
- 基本的な操作サポート（停止・再開・招待リンク再発行）

---

## 4. 非対象事項（スコープ外）

### 4.1 Phase 1で対象外
- **複数店舗管理**: 1店舗での完全動作を優先
- **給与計算**: 勤怠データの提供のみ（連携は将来検討）
- **労基法チェック**: 基本的な時間計算のみ
- **高度な分析**: 基本レポートのみ
- **モバイルアプリ**: PWA対応は将来検討

### 4.2 将来の拡張予定
- 多店舗対応・店舗間シフト調整
- 労務管理システム連携
- 予算・人件費管理
- 詳細な分析・予測機能
- API連携（POS・人事システム）

---

## 5. 成功基準・KPI定義

### 5.1 ビジネス成功指標
| 指標 | 現状 | 目標 | 測定方法 |
|------|------|------|----------|
| シフト作成時間 | 120分/月 | 24分/月 | ユーザーログ |
| 打刻不正検出 | 目視チェック | 自動検出95% | システムログ |
| 勤怠計算精度 | 手計算エラー20% | システムエラー2%以下 | 計算差異チェック |

### 5.2 技術指標
| 指標 | 目標値 | 測定方法 |
|------|--------|----------|
| ページ読み込み時間 | 3秒以内 | Lighthouse |
| API応答時間 | 2秒以内 | APM監視 |
| 稼働率 | 99.5%以上 | Uptime監視 |
| モバイル対応性 | 95点以上 | Lighthouse Mobile |

### 5.3 ユーザビリティ指標
| 指標 | 目標値 | 測定方法 |
|------|--------|----------|
| 初回ログイン成功率 | 95%以上 | ユーザーフロー分析 |
| シフト希望提出完了率 | 90%以上 | コンバージョン率 |
| 打刻操作成功率 | 98%以上 | エラー率分析 |
| サポート問い合わせ | 月5件以下 | サポートログ |

---

## 6. 変更管理・承認プロセス

### 6.1 要件変更管理
**変更レベル定義**
- **レベル1（軽微）**: UI改善・文言修正 → 開発リーダー承認
- **レベル2（中程度）**: 機能追加・API変更 → プロダクトオーナー承認
- **レベル3（重要）**: 技術スタック変更・仕様大幅変更 → ステークホルダー承認

**変更手順**
1. 変更要求書作成（影響範囲・工数・リスク分析）
2. レベル別承認プロセス
3. 関連文書の更新
4. チーム通知・スケジュール調整

### 6.2 品質保証
**段階的チェック**
- [ ] 仕様レビュー（要件定義・設計文書）
- [ ] 実装レビュー（コードレビュー・セキュリティチェック）
- [ ] テスト（単体・結合・E2E・ユーザビリティ）
- [ ] 本番デプロイ前チェック（パフォーマンス・セキュリティ）

**受け入れ基準**
- すべての機能要件が実装されている
- パフォーマンス目標を満たしている
- セキュリティ要件をクリアしている
- ユーザビリティテストで目標値を達成している

---

## 7. プロジェクトスケジュール・マイルストーン

### 7.1 開発フェーズ（8週間）

**Week 1-2: 基盤構築**
- [ ] プロジェクト初期設定
- [ ] Next.js + Supabase環境構築
- [ ] 認証機能実装（招待制）
- [ ] 基本的なUI/UXコンポーネント作成

**Week 3-4: コア機能実装**
- [ ] 出退勤管理（位置情報なし）
- [ ] シフト希望提出・確認
- [ ] 従業員管理基本機能
- [ ] 管理者ダッシュボード

**Week 5-6: 高度機能実装**
- [ ] 位置情報連動打刻
- [ ] AI自動シフト作成（Gemini API連携）
- [ ] シフト手動調整機能
- [ ] 勤怠管理・編集機能

**Week 7-8: 統合・仕上げ**
- [ ] 統合テスト・バグ修正
- [ ] パフォーマンス最適化
- [ ] セキュリティ監査
- [ ] 本番環境デプロイ・運用準備

### 7.2 重要マイルストーン
| マイルストーン | 完了基準 | 期限 |
|----------------|----------|------|
| MVP機能完成 | 全機能の基本動作確認 | Week 6 |
| α版リリース | 内部テスト開始可能 | Week 7 |
| β版リリース | 実ユーザーテスト開始 | Week 8 |
| 正式リリース | 本番運用開始 | Week 8 |

---

## 8. リスク管理

### 8.1 技術リスク
| リスク | 影響度 | 確率 | 対策 |
|--------|--------|------|------|
| 位置情報API制限 | 高 | 中 | フォールバック機能・手動承認 |
| Gemini API制限 | 中 | 低 | 使用量監視・代替API準備 |
| Supabase障害 | 高 | 低 | SLA確認・バックアップ戦略 |
| パフォーマンス問題 | 中 | 中 | 継続的監視・最適化 |

### 8.2 ビジネスリスク
| リスク | 影響度 | 確率 | 対策 |
|--------|--------|------|------|
| ユーザー受容度 | 高 | 中 | ユーザーテスト・フィードバック収集 |
| 競合他社 | 中 | 中 | 差別化機能・継続的改善 |
| 法的要件変更 | 中 | 低 | 労働法専門家監修 |
| セキュリティ問題 | 高 | 低 | セキュリティ監査・ペネトレーションテスト |

### 8.3 対策・緊急時対応
**緊急時エスカレーション**
1. **レベル1**: 開発チーム内対応（24時間以内）
2. **レベル2**: プロダクトオーナー判断（12時間以内）
3. **レベル3**: 経営陣判断・外部リソース投入（6時間以内）

**バックアップ計画**
- データバックアップ: 日次自動・週次手動確認
- システム復旧: RTO 4時間・RPO 1時間
- 代替運用: 紙・Excel併用（緊急時のみ）

---

## 文書改訂履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|---------|--------|
| 1.0 | 2024年XX月 | 初版作成 | 開発チーム |
| 2.0 | 2025年8月13日 | デモ画面ベースの詳細化・KPI定義・リスク管理追加 | システム設計者 |

**承認**
- プロダクトオーナー: _____________ 日付: _______
- 開発リーダー: _____________ 日付: _______
- ビジネスサイド: _____________ 日付: _______