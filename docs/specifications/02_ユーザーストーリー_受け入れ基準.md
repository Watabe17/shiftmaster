# ユーザーストーリー＋受け入れ基準 - シフト管理システム

**文書バージョン**: 1.0  
**作成日**: 2025年8月13日  
**プロジェクト名**: ShiftMaster

---

## 文書概要

本文書は、シフト管理システムの各機能をユーザーの視点から記述したユーザーストーリーと、その実装完了を判定する受け入れ基準を定義します。開発チームが要件を正確に理解し、ユーザー価値を最大化する実装を行うための指針となります。

---

## 1. 認証・オンボーディング

### US-001: 招待による従業員登録
**ユーザー**: 新入従業員  
**ロール**: 従業員  
**目的**: スムーズにシステムに参加する  
**価値**: 管理者の手間なく迅速にアカウント作成できる

**ストーリー**:  
新入従業員として、管理者から受け取った招待リンクまたはQRコードを使って、簡単にアカウントを作成したい。メールアドレスがなくても利用開始でき、初回設定で必要な情報を一度に入力できるようにしたい。

**受け入れ基準**:
- [ ] 招待リンクをクリックまたはQRコードをスキャンして招待ページにアクセスできる
- [ ] 招待トークンが有効期限内（24h/72h/7d）の場合、従業員情報が表示される
- [ ] 氏名、従業員コード、店舗名が表示され、内容を確認できる
- [ ] メールアドレス（任意）とパスワードを設定できる
- [ ] パスワード強度が視覚的に表示される（弱い/普通/強い/とても強い）
- [ ] 設定完了後、「5秒後にログイン画面に遷移」のメッセージが表示される
- [ ] 期限切れの場合、「再発行をお願いします」のメッセージが表示される
- [ ] 使用済みトークンの場合、ログイン画面への導線が表示される

**シナリオ例**:
1. 管理者から招待QRコードを受け取る
2. スマートフォンでQRコードをスキャン
3. 招待ページで自分の情報を確認
4. メールアドレスとパスワードを設定
5. 設定完了後、自動的にログイン画面へ遷移

---

### US-002: システムへのログイン
**ユーザー**: 従業員・管理者  
**ロール**: 全ユーザー  
**目的**: セキュアにシステムにアクセスする  
**価値**: 簡単かつ安全にログインできる

**ストーリー**:  
従業員として、メールアドレスとパスワードでログインし、自分の権限に応じた機能にアクセスしたい。ログインできない場合は、適切なサポート情報が表示されることを期待する。

**受け入れ基準**:
- [ ] メールアドレスとパスワードを入力してログインできる
- [ ] ログイン成功時、権限に応じたホーム画面に遷移する（従業員→出退勤、管理者→ダッシュボード）
- [ ] 「パスワードをお忘れの方」リンクからパスワードリセットページに遷移できる
- [ ] 招待制であることが明記されている
- [ ] 認証エラー時、適切なエラーメッセージが表示される
  - 未招待/無効化: 「このアカウントは未招待/無効です。管理者にご確認ください」
  - 誤パスワード: 「メールアドレスまたはパスワードが正しくありません」

**シナリオ例**:
1. ログイン画面でメールアドレスとパスワードを入力
2. ログインボタンをクリック
3. 認証成功後、従業員は出退勤画面、管理者はダッシュボードに遷移

---

## 2. 出退勤管理

### US-003: 位置情報チェック付き出勤
**ユーザー**: 従業員  
**ロール**: 従業員  
**目的**: 店舗にいることを証明して出勤を記録する  
**価値**: 不正打刻を防ぎ、正確な勤怠管理ができる

**ストーリー**:  
従業員として、店舗に到着した時に、位置情報で店舗にいることが確認されたら出勤ボタンを押して、正確な出勤時刻を記録したい。位置情報が取得できない場合や圏外の場合は、状況がわかるようにしたい。

**受け入れ基準**:
- [ ] 画面上部に現在時刻が大きく表示される（年月日・曜日・時刻（秒））
- [ ] 位置情報の取得状況が表示される（取得中/許可済み/範囲外/エラー）
- [ ] 店舗から50m以内にいる場合のみ出勤ボタンが有効になる
- [ ] 出勤ボタンを押すと出勤時刻が記録される
- [ ] 出勤完了後、緑系の完了画面で「本日もよろしくお願いいたします！」が表示される
- [ ] simpleモード時は5秒後に従業員選択画面に自動リセットされる
- [ ] 位置情報エラー時、原因と対処法が表示される
- [ ] 同一日の重複出勤は防止される

**シナリオ例**:
1. 店舗に到着してスマートフォンでアプリを開く
2. 位置情報取得中の表示を確認
3. 「位置情報OK」の表示と出勤ボタンの有効化を確認
4. 出勤ボタンをタップ
5. 出勤完了画面で時刻と挨拶メッセージを確認

---

### US-004: 休憩時間を含む退勤
**ユーザー**: 従業員  
**ロール**: 従業員  
**目的**: 正確な実働時間を記録する  
**価値**: 適正な勤務時間管理と給与計算の基礎データとなる

**ストーリー**:  
従業員として、勤務終了時に退勤ボタンを押し、その日の休憩時間を入力して、正確な実働時間を記録したい。休憩時間は予め設定された選択肢から選べ、必要に応じてカスタム入力もできるようにしたい。

**受け入れ基準**:
- [ ] 出勤中の場合のみ退勤ボタンが有効になる
- [ ] 退勤ボタンを押すと休憩時間入力モーダルが表示される
- [ ] クイック選択：なし/30分/45分/60分（デフォルト60分）が用意されている
- [ ] カスタム入力で15分単位での入力ができる
- [ ] 休憩時間確定後、退勤時刻が記録される
- [ ] 実働時間が自動計算される（勤務時間 - 休憩時間）
- [ ] 退勤完了後、青系の完了画面で「お疲れ様でした！」が表示される
- [ ] 勤務時間と休憩時間の詳細が表示される
- [ ] simpleモード時は5秒後に従業員選択画面に自動リセットされる

**シナリオ例**:
1. 勤務終了時、退勤ボタンをタップ
2. 休憩時間選択モーダルで「60分」を選択
3. 退勤確定ボタンをタップ
4. 完了画面で退勤時刻と実働時間を確認
5. お疲れ様メッセージを確認

---

### US-005: 勤務モード切替（共用端末対応）
**ユーザー**: 複数従業員  
**ロール**: 従業員  
**目的**: 共用端末でも個人別に打刻する  
**価値**: 端末コストを削減しながら個人別勤怠管理ができる

**ストーリー**:  
従業員として、店舗の共用タブレットを使って、まず自分を選択してから出退勤の打刻をしたい。打刻完了後は自動的に次の人が使えるように従業員選択画面に戻ってほしい。

**受け入れ基準**:
- [ ] 簡易モード時、従業員選択画面が表示される
- [ ] プルダウンまたは従業員コード入力で従業員を選択できる
- [ ] 従業員選択後、その従業員用の出退勤画面に遷移する
- [ ] 出勤・退勤完了後、5秒のカウントダウンで従業員選択画面に自動リセットされる
- [ ] 手動で「次の従業員で打刻」ボタンでもリセットできる
- [ ] 現在選択中の従業員名が画面に明確に表示される
- [ ] ログインモードとの切り替えがヘッダーで可能

**シナリオ例**:
1. 共用タブレットの従業員選択画面を開く
2. プルダウンから自分の名前を選択または従業員コードを入力
3. 自分専用の出退勤画面で打刻
4. 完了画面の後、5秒後に自動的に従業員選択画面に戻る
5. 次の従業員が同様に操作可能

---

## 3. シフト管理（従業員）

### US-006: 月次シフト希望の提出
**ユーザー**: 従業員  
**ロール**: 従業員  
**目的**: 自分の勤務可能日時を効率的に伝える  
**価値**: 希望を反映したシフトで働くことができる

**ストーリー**:  
従業員として、来月のシフト希望をカレンダー形式で入力し、勤務可能日と不可能日、希望時間を設定して管理者に提出したい。複数日をまとめて設定でき、提出前に内容を確認できるようにしたい。

**受け入れ基準**:
- [ ] 月選択（前後切り替え）で対象月を選べる
- [ ] 進捗バーで当月の提出率が表示される
- [ ] カレンダーとリストのタブ切り替えができる
- [ ] 日付クリック/タップで選択、複数選択（Shift+クリック、範囲選択）ができる
- [ ] 一括編集パネルで選択日の設定ができる
  - クイック設定：早番/日勤/遅番/終日可
  - 勤務可否：OK/NG
  - 希望時間：開始・終了時刻（15分刻み）
  - 備考：自由入力
- [ ] 下書き保存で即座に保存され、保存状況が表示される（saving→saved）
- [ ] 提出ボタンで確定し、提出後は「提出済み」バッジが表示される
- [ ] 締切日が画面に明示される（例：前月25日）
- [ ] 締切後は編集不可（管理者による再開まで）

**シナリオ例**:
1. シフト提出画面で来月を選択
2. カレンダーで希望日をクリックして選択
3. 一括編集パネルで「日勤（09:00-17:00）」を設定
4. 不可能日をクリックして「NG」を設定
5. 下書き保存で一時保存
6. 内容確認後、提出ボタンで確定

---

### US-007: 確定シフトの確認
**ユーザー**: 従業員  
**ロール**: 従業員  
**目的**: 自分の勤務予定を把握する  
**価値**: 計画的な生活とスケジュール管理ができる

**ストーリー**:  
従業員として、管理者が作成した確定シフトを見やすい形で確認し、勤務日・時間・ポジションを把握したい。詳細情報も確認でき、必要に応じて印刷やダウンロードもできるようにしたい。

**受け入れ基準**:
- [ ] 当月の確定シフトがカレンダー形式で表示される
- [ ] カレンダーとリストのタブ切り替えができる
- [ ] 勤務日にはシフト区分（早番/日勤/遅番）と時間が表示される
- [ ] 当日は特別な強調表示（リング）がされる
- [ ] 休みの日は「休み」と表示される
- [ ] 日付クリック/タップで詳細モーダルが表示される
  - 日付・曜日
  - 勤務時間・合計時間
  - シフト区分・ポジション
- [ ] PC版では印刷/ダウンロード機能が利用できる
- [ ] 管理者による変更は自動で反映される
- [ ] モバイルでは全幅ボトムシート、PCでは中央カードで詳細表示

**シナリオ例**:
1. 確定シフト画面を開く
2. カレンダーで今月の勤務予定を一覧確認
3. 特定の日付をクリックして詳細確認
4. 勤務時間とポジションを確認
5. 月末に印刷ボタンでシフト表を印刷

---

## 4. シフト管理（管理者）

### US-008: ダッシュボードでの状況把握
**ユーザー**: 店舗管理者  
**ロール**: 管理者  
**目的**: 店舗運営状況を素早く把握する  
**価値**: 効率的な店舗管理と適切な意思決定ができる

**ストーリー**:  
店舗管理者として、システムにログインした時に、今週の提出状況、未提出者、勤怠状況などを一目で把握し、必要な対応を素早く判断できるようにしたい。よく使う機能にはワンクリックでアクセスしたい。

**受け入れ基準**:
- [ ] ヘッダーに店舗名と対象月選択が表示される
- [ ] 今週の状況カード（3つ）が表示される
  - 提出件数（オレンジ系）
  - 未提出者数（ブルー系）
  - 勤怠修正申請（グリーン系）
- [ ] シフト希望提出状況セクションが表示される
  - 提出率の進捗バー
  - 従業員一覧（提出済み/未提出バッジ、最終更新時刻）
- [ ] クイックアクションが表示される
  - シフト管理（オレンジ）
  - 従業員管理（ブルー）
  - 勤怠管理（グリーン）
- [ ] 最近の更新情報（時系列）が表示される
- [ ] 主要CTAボタン「今月のシフトを作成」が目立つ位置に配置される

**シナリオ例**:
1. 管理者としてログイン
2. ダッシュボードで今週の提出状況を確認
3. 未提出者が3名いることを把握
4. 「従業員管理」クイックアクションで未提出者に連絡
5. 「シフト作成」CTAボタンで今月のシフト作成を開始

---

### US-009: AI支援によるシフト作成
**ユーザー**: 店舗管理者  
**ロール**: 管理者  
**目的**: 効率的に最適なシフトを作成する  
**価値**: 手作業の時間を大幅削減し、公平で効率的なシフトができる

**ストーリー**:  
店舗管理者として、従業員の希望と店舗の必要人数を考慮して、AIが最適なシフトを自動生成してくれることを期待する。生成後も手動で調整でき、最終的な人員バランスも確認できるようにしたい。

**受け入れ基準**:
- [ ] Step 0: 初期設定画面が表示される
  - 下書きがある場合は再開/削除オプション
  - 作成対象ポジション選択（全ポジション/個別）
  - ルールセット選択（通常期/繁忙期/閑散期など）
- [ ] Step 1: 提出状況確認画面が表示される
  - 28日分の横スクロール可能テーブル
  - 従業員×日付のマトリクス表示
  - 希望内容の視覚的表示（◯/時間/条件付き/不可/未提出）
  - CSV出力機能
- [ ] Step 2: AI生成画面が表示される
  - 適用ルール、対象ポジション、提出率、対象人数のサマリー
  - 「シフトを生成」ボタンで AI処理開始
  - 生成中はスピナー表示
- [ ] Step 3: 調整・確定画面が表示される
  - シフト表ビュー：従業員×日付、セルクリックで編集モーダル
  - 人員数ビュー：ポジション×時間、過不足の色分け表示
  - 下書き保存、CSV出力、シフト確定機能

**シナリオ例**:
1. 「今月のシフト作成」ボタンをクリック
2. ルールセット「通常期」を選択してStep 1へ
3. 従業員の希望提出状況を確認してStep 2へ
4. AIシフト生成ボタンをクリックして生成待ち
5. Step 3で生成結果を確認し、必要に応じて手動調整
6. 人員数ビューで過不足を確認後、シフト確定

---

### US-010: 従業員情報の管理
**ユーザー**: 店舗管理者  
**ロール**: 管理者  
**目的**: 従業員情報を正確に管理する  
**価値**: 効率的な人事管理と正確な労働条件設定ができる

**ストーリー**:  
店舗管理者として、従業員の基本情報、雇用条件、勤務実績を一元管理し、新規従業員の招待や既存従業員の情報更新を簡単に行いたい。一覧での検索・フィルタや一括操作も効率的に行えるようにしたい。

**受け入れ基準**:
- [ ] ヘッダーに総人数・稼働中人数が表示される
- [ ] CSV取込・エクスポート・新規登録ボタンが配置される
- [ ] 検索・フィルタ機能が利用できる
  - キーワード検索（名前/カナ/メール/従業員コード）
  - 雇用形態フィルタ（正社員/パート/契約）
  - ステータスフィルタ（稼働中/休止中）
- [ ] 一覧テーブルに必要な情報が表示される
  - チェックボックス（全選択/個別選択）
  - 従業員情報（コード・氏名）
  - 雇用形態・ポジション（色バッジ）
  - 有給残・社会保険・月間上限・今月実績
  - ステータストグル・編集ボタン
- [ ] 新規/編集モーダルに3タブが用意される
  - 基本情報・雇用情報・社会保険&有給
- [ ] 招待リンク生成・管理機能が利用できる
- [ ] 選択件数がフッターに表示される

**シナリオ例**:
1. 従業員管理画面で「新規登録」をクリック
2. 基本情報タブで従業員コード・氏名・メールを入力
3. 雇用情報タブで雇用形態・対応ポジションを設定
4. 保存後、「招待リンク生成」で招待QRコードを作成
5. QRコードを印刷して新入従業員に渡す

---

### US-011: 勤怠データの管理・修正
**ユーザー**: 店舗管理者  
**ロール**: 管理者  
**目的**: 正確な勤怠記録を維持する  
**価値**: 適正な労働時間管理と給与計算の基礎データとなる

**ストーリー**:  
店舗管理者として、従業員の勤怠データを日次・月次で確認し、打刻ミスや記録漏れがあった場合は理由を記録して修正できるようにしたい。位置情報チェックの結果も確認して、適切な勤怠管理を行いたい。

**受け入れ基準**:
- [ ] 日次/月次ビューの切り替えができる
- [ ] 日次ビューの機能
  - 日付選択（前日/翌日ボタン、日付入力）
  - サマリー（出勤予定/出勤済み/残業合計）
  - テーブル（従業員/シフト/出勤/退勤/休憩/実働/残業/位置/編集）
- [ ] 月次ビューの機能
  - 月選択・従業員選択
  - サマリー（出勤日数/総勤務時間/残業時間）
  - テーブル（日付/シフト/出勤/退勤/実働/残業/備考/編集）
- [ ] 編集モーダルの機能
  - 対象従業員・日付の表示
  - 出勤/退勤時刻、休憩時間の入力
  - 修正理由の必須入力
  - 保存/キャンセル
- [ ] 位置情報チェック結果の表示（OK=緑アイコン）
- [ ] CSV出力機能（日次/月次）

**シナリオ例**:
1. 勤怠管理画面で今日の日次ビューを表示
2. ある従業員の「退勤」欄が空白であることを確認
3. 編集ボタンをクリックして編集モーダルを開く
4. 退勤時刻「18:00」、休憩「60分」を入力
5. 修正理由「打刻忘れのため手動追加」を入力して保存

---

## 5. システム設定・管理

### US-012: 店舗設定の管理
**ユーザー**: 店舗管理者  
**ロール**: 管理者  
**目的**: 店舗の運営ルールをシステムに反映する  
**価値**: 店舗の実情に合わせた正確な勤怠管理ができる

**ストーリー**:  
店舗管理者として、営業時間、打刻ルール、休憩ルール、ポジション設定などを店舗の実情に合わせて設定し、システムを適切に運用したい。設定変更時は保存状況が分かり、影響範囲も理解できるようにしたい。

**受け入れ基準**:
- [ ] 5つのタブが用意される
  - 基本情報・営業時間/定休日・打刻/計上ルール・休憩ルール・ポジション管理
- [ ] 基本情報タブ
  - 店舗名・住所・電話・通知メール
  - 打刻位置（住所検索→地図→座標設定）
- [ ] 営業時間タブ
  - 曜日別開店/閉店時刻
  - 定休日設定・翌日閉店（跨ぎ）
- [ ] 打刻/計上ルールタブ
  - 営業時間外勤務許容・早出/残業許容分
  - 丸めルール（1/5/10/15/30分、切捨/切上/四捨五入）
  - 遅刻/早退猶予時間
- [ ] 休憩ルールタブ
  - 連続労働時間に応じた自動休憩設定
- [ ] ポジション管理タブ
  - コード/名称/色/並び順/有効・無効
  - ドラッグ&ドロップ並び替え
- [ ] 保存ボタンで保存中スピナー/成功トースト表示
- [ ] 未保存離脱時の確認ダイアログ

**シナリオ例**:
1. 店舗設定画面で「営業時間/定休日」タブを選択
2. 平日の営業時間を「09:00-22:00」に設定
3. 日曜日を定休日として設定
4. 「変更を保存」ボタンで保存
5. 成功トーストで保存完了を確認

---

### US-013: 招待コード管理（運営向け）
**ユーザー**: システム運営者  
**ロール**: system_admin  
**目的**: 複数店舗への招待コード配布を管理する  
**価値**: スポンサー店舗への支援やキャンペーン実施ができる

**ストーリー**:  
システム運営者として、特定の店舗やキャンペーン参加者に向けて、決済スキップ可能な招待コードを発行・管理し、利用状況を追跡したい。セキュリティを保ちながら効率的な配布を行いたい。

**受け入れ基準**:
- [ ] 招待コード一覧画面に必要な情報が表示される
  - コード・期限・上限・使用回数・メモ・作成日
- [ ] 新規発行機能
  - コード自動生成・有効期限設定・使用回数上限・メモ入力
- [ ] 発行済みコード管理
  - 有効/無効切り替え・詳細確認・削除
- [ ] 使用状況確認
  - 使用履歴・使用者情報・使用日時
- [ ] コードコピー機能
- [ ] 検索・フィルタ機能（期限・使用状況）

**シナリオ例**:
1. 運営管理画面で「招待コード管理」を選択
2. 「新規発行」ボタンで発行画面を開く
3. 有効期限「30日」、上限「5回」、メモ「スポンサー様用」を設定
4. コード発行後、コピーボタンでクリップボードにコピー
5. スポンサーにメールで送付

---

## 6. エラーハンドリング・例外処理

### US-014: システムエラー時の適切な対応
**ユーザー**: 全ユーザー  
**ロール**: 全ユーザー  
**目的**: エラー発生時でも状況を理解し適切に対応する  
**価値**: システムの信頼性とユーザー体験の向上

**ストーリー**:  
ユーザーとして、システムエラーやネットワーク障害が発生した時に、何が起こっているのかを理解し、どう対応すれば良いかを知りたい。可能な限り操作を継続でき、データが失われないようにしたい。

**受け入れ基準**:
- [ ] ネットワークエラー時の表示
  - 接続状況の表示・自動リトライ・手動リトライボタン
- [ ] 位置情報エラー時の表示
  - エラー原因（未許可/測位失敗/精度不足）の明示
  - 対処法の案内・手動承認オプション
- [ ] API呼び出しエラー時の表示
  - エラーメッセージ・リトライボタン・サポート連絡先
- [ ] セッション切れ時の処理
  - 自動ログアウト・ログイン画面への遷移・作業内容の保持
- [ ] バリデーションエラー時の表示
  - フィールド単位のエラー表示・修正ガイダンス
- [ ] システムメンテナンス時の通知
  - 事前通知・メンテナンス中画面・復旧予定時刻

**シナリオ例**:
1. 出勤打刻時にネットワークが切断される
2. 「ネットワークに接続できません」のエラー表示
3. 「リトライ」ボタンで再試行
4. 接続復旧後、正常に打刻完了
5. オフライン中のデータは保持される

---

## 7. パフォーマンス・ユーザビリティ

### US-015: 快適な操作性の提供
**ユーザー**: 全ユーザー  
**ロール**: 全ユーザー  
**目的**: ストレスなくシステムを利用する  
**価値**: 日常業務の効率化と操作ミスの削減

**ストーリー**:  
ユーザーとして、システムの画面読み込みや操作レスポンスが早く、直感的に使えるインターフェースで、ストレスなく日常の業務を行いたい。モバイルでもPCでも同様に快適に利用したい。

**受け入れ基準**:
- [ ] パフォーマンス要件
  - 初回ページ読み込み：3秒以内
  - ページ遷移：1秒以内
  - API呼び出し：2秒以内
  - 位置情報取得：5秒以内
- [ ] レスポンシブデザイン
  - モバイル（375px～）・タブレット（768px～）・デスクトップ（1024px～）
  - タッチ操作対応・適切なボタンサイズ
- [ ] アクセシビリティ
  - キーボード操作対応・スクリーンリーダー対応
  - 十分なコントラスト比・視覚的フィードバック
- [ ] オフライン対応
  - 基本的なPWA機能・オフライン時の適切な表示
- [ ] 操作フィードバック
  - ローディング表示・成功/エラートースト
  - 保存状況の表示・確認ダイアログ

**シナリオ例**:
1. スマートフォンでシフト提出画面を開く
2. 3秒以内にページが読み込まれる
3. カレンダーのタップ操作が快適に動作
4. 保存時は「saving→saved」の視覚的フィードバック
5. ネットワーク切断時も適切なエラー表示

---

## 実装優先度

### High Priority（必須）
- US-001, 002: 認証・オンボーディング
- US-003, 004: 出退勤管理
- US-006, 007: シフト希望・確認
- US-008, 009: ダッシュボード・AI シフト作成
- US-014, 015: エラーハンドリング・パフォーマンス

### Medium Priority（重要）
- US-005: 勤務モード切替
- US-010, 011: 従業員管理・勤怠管理
- US-012: 店舗設定

### Low Priority（あると良い）
- US-013: 招待コード管理（運営向け）

---

## テスト観点

各ユーザーストーリーは以下の観点でテストします：

1. **機能テスト**: 受け入れ基準の全項目が満たされているか
2. **ユーザビリティテスト**: ストーリーのシナリオが自然に実行できるか
3. **パフォーマンステスト**: レスポンス時間の要件を満たしているか
4. **セキュリティテスト**: 権限制御とデータ保護が適切か
5. **回帰テスト**: 他の機能に影響を与えていないか

---

## 文書改訂履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|---------|--------|
| 1.0 | 2025年8月13日 | 初版作成 | システム設計者 |